---
interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings: Heading[];
}

const { headings } = Astro.props;

// Filter to only h2 and h3
const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <nav class="text-sm" aria-label="Table of Contents">
    <h4 class="font-semibold mb-3" style="color: var(--color-text);">
      Contents
    </h4>
    <ul class="space-y-2">
      {filteredHeadings.map((heading) => (
        <li
          class={heading.depth === 3 ? 'ml-4' : ''}
        >
          <a
            href={`#${heading.slug}`}
            class="block py-1 hover:text-[var(--color-accent)] transition-colors"
            style="color: var(--color-text-secondary);"
          >
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<script>
  // Highlight current section in TOC
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const id = entry.target.getAttribute('id');
        const tocLink = document.querySelector(`nav a[href="#${id}"]`);
        if (tocLink) {
          if (entry.isIntersecting) {
            document.querySelectorAll('nav a').forEach((link) => {
              link.classList.remove('font-medium');
              link.style.color = 'var(--color-text-secondary)';
            });
            tocLink.classList.add('font-medium');
            (tocLink as HTMLElement).style.color = 'var(--color-accent)';
          }
        }
      });
    },
    { rootMargin: '-80px 0px -80% 0px' }
  );

  document.querySelectorAll('h2[id], h3[id]').forEach((heading) => {
    observer.observe(heading);
  });
</script>
