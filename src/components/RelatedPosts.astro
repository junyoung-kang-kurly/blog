---
import FormattedDate from './FormattedDate.astro';

interface Post {
  id: string;
  data: {
    title: string;
    description: string;
    pubDate: Date;
    tags: string[];
  };
}

interface Props {
  currentSlug: string;
  currentTags: string[];
  allPosts: Post[];
}

const { currentSlug, currentTags, allPosts } = Astro.props;

// Find related posts based on shared tags
const relatedPosts = allPosts
  .filter((post) => post.id !== currentSlug)
  .map((post) => {
    const sharedTags = post.data.tags.filter((tag) => currentTags.includes(tag));
    return { post, score: sharedTags.length };
  })
  .filter(({ score }) => score > 0)
  .sort((a, b) => b.score - a.score)
  .slice(0, 3)
  .map(({ post }) => post);
---

{relatedPosts.length > 0 && (
  <section class="mt-12 pt-8 border-t border-[var(--color-border)]">
    <h2 class="text-xl font-bold mb-6" style="color: var(--color-text);">
      Related Posts
    </h2>
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {relatedPosts.map((post) => (
        <a
          href={`/blog/${post.id}`}
          class="block p-4 rounded-lg border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-colors"
          style="background-color: var(--color-bg-secondary);"
        >
          <h3 class="font-medium line-clamp-2" style="color: var(--color-text);">
            {post.data.title}
          </h3>
          <p class="text-sm mt-2 line-clamp-2" style="color: var(--color-text-secondary);">
            {post.data.description}
          </p>
          <time class="text-xs mt-2 block" style="color: var(--color-text-secondary);">
            <FormattedDate date={post.data.pubDate} />
          </time>
        </a>
      ))}
    </div>
  </section>
)}
